!function(){function e(e){return document.getElementById(e)}var a=e("entregador"),i=e("estacao"),c=e("codigo"),d=e("btnRegistrar"),r=e("msgArea"),s=e("ultimos-rows"),l="track:lastSelection";function g(e,t){r.innerHTML='<div class="alert '+((t=!1!==t)?"alert-success":"alert-warning")+' d-flex align-items-center" role="alert"><i class="'+(t?"ri-check-line":"ri-error-warning-line")+' me-2"></i><div>'+e+"</div></div>"}function u(){var n=[];var e=function(e){for(var t=0;t<n.length;t++){var r=n[t],o=r.normalizar?(o=e,"Mercado Livre"===r.servico?String(o||"").replace(/\D+/g,""):o):e;try{if(new RegExp(r.regex).test(o))return{ok:!0,servico:r.servico,codigo:o}}catch(e){}}return{ok:!1}}(codigo);e.ok?(codigo=e.codigo,e.servico):g("Código não corresponde a nenhum padrão configurado.",!1)}function t(){var e,t=a.value||"",r=i.value||"",o=(c.value||"").trim(),n=u();n.ok?t?r?(g("Registrando…",!0),d.disabled=!0,e={entregador:a.value||"",estacao:i.value||""},localStorage.setItem(l,JSON.stringify(e)),window.TrackAPI.registerSaida({entregador:t,estacao:r,codigo:o}).then(function(e){if(d.disabled=!1,e&&!1!==e.ok){var t=e.row||{},t="<tr><td>"+((t=t).tsFmt||"")+"</td><td>"+(t.entregador||"")+"</td><td>"+(t.codigo||"")+"</td><td>"+(t.servico||"")+"</td><td>"+(t.status||"")+"</td><td>"+(t.duplicado?"Sim":"Não")+"</td><td>"+(t.estacao||"")+"</td></tr>",r=(s.insertAdjacentHTML("afterbegin",t),s.querySelectorAll("tr"));if(10<r.length)for(var o=10;o<r.length;o++)r[o].remove();g("Registrado com sucesso.",!0),c.value="",c.focus()}else g(e&&e.error||"Falha ao registrar.",!1)}).catch(function(e){d.disabled=!1,g("Erro: "+(e&&e.message||String(e)),!1)})):(g("Selecione a estação.",!1),i.focus()):(g("Selecione o entregador.",!1),a.focus()):(g(n.msg,!1),c.focus())}d&&d.addEventListener("click",t),c&&c.addEventListener("keydown",function(e){"Enter"===e.key&&(e.preventDefault(),t())}),window.TrackAPI.getConfig().then(function(e){var t=e&&e.entregadores||[],e=e&&e.estacoes||[];a.innerHTML=t.map(function(e){return"<option>"+e+"</option>"}).join(""),i.innerHTML=e.map(function(e){return"<option>"+e+"</option>"}).join("");try{var r=JSON.parse(localStorage.getItem(l)||"{}");r.entregador&&0<=t.indexOf(r.entregador)&&(a.value=r.entregador),r.estacao&&0<=e.indexOf(r.estacao)&&(i.value=r.estacao)}catch(e){}}).then(function(){c&&(c.focus(),c.select)&&c.select()})}();