const API_BASE="https://track-saidas-api.onrender.com/api/auth";function getNextParam(){return new URL(window.location.href).searchParams.get("next")}function showError(e){var n=document.getElementById("loginError");n.textContent=e||"Falha no login.",n.classList.remove("d-none")}console.log("[signin] script carregado");const form=document.getElementById("loginForm");form?form.addEventListener("submit",async e=>{e.preventDefault(),e.stopPropagation(),console.log("[signin] submit interceptado");var e=document.getElementById("email").value.trim(),n=document.getElementById("password-input").value,o=document.getElementById("auth-remember-check")?.checked||!1,t=document.getElementById("signinBtn");if(!e||!n)return showError("Preencha email e senha."),!1;t.disabled=!0;try{console.log("[signin] POST",API_BASE+"/login",{email:e,remember:o});var r,a,i,s=await fetch(API_BASE+"/login",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:e,password:n,remember:o})});return(console.log("[signin] /auth/login status =",s.status),s.ok)?(r=API_BASE+"/me",console.log("[signin] GET",r),a=await fetch(r,{credentials:"include"}),console.log("[signin] /auth/me status =",a.status),a.ok?(i=getNextParam(),window.location.href=i||"index.html",!1):(showError("Sessão não criada. Verifique as flags do cookie (Secure/SameSite/CORS)."),t.disabled=!1)):(showError((await s.json().catch(()=>({}))).detail||"Usuário ou senha inválidos."),t.disabled=!1)}catch(e){return console.error("[signin] erro no fetch",e),showError("Falha ao conectar. Tente novamente."),t.disabled=!1}}):console.error("[signin] Não encontrei #loginForm");