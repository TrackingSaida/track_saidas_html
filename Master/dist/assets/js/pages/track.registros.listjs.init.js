!function(){var t,o,a,d,e,r,n,l,i,c,s,u,g,m,v,f,b,h;function p(e){var t="Saiu"===e.status?'<span class="badge bg-success-subtle text-success">Saiu</span>':'<span class="badge bg-warning-subtle text-warning">'+(e.status||"")+"</span>";return'<tr data-id="'+e.id+'"><td><div class="form-check"><input class="form-check-input" type="checkbox" name="chk_child"></div></td><td class="datahora">'+(e.tsFmt||"")+'</td><td class="codigo">'+(e.codigo||"")+'</td><td class="entregador">'+(e.entregador||"")+'</td><td class="servico">'+(e.servico||"")+'</td><td class="status">'+t+'</td><td class="duplicado">'+(e.duplicado?"Sim":"Não")+'</td><td class="estacao">'+(e.estacao||"")+'</td><td class="action text-end"><button class="btn btn-sm btn-success edit-item-btn" data-bs-toggle="modal" data-bs-target="#showModal">Editar</button> <button class="btn btn-sm btn-danger remove-item-btn" data-bs-toggle="modal" data-bs-target="#deleteRecordModal">Excluir</button></td></tr>'}function y(){window.TrackAPI.listSaidas({page:1,pageSize:500,sort:"-ts"}).then(function(e){if(e&&e.ok){if(h=e.rows||[],o.innerHTML=h.map(p).join(""),b)try{b.clear()}catch(e){}b=new List(t,{valueNames:["datahora","codigo","entregador","servico","status","duplicado","estacao","action"],page:20,pagination:!0});try{b.sort("datahora",{order:"desc"})}catch(e){}o.addEventListener("click",function(e){var t=e.target.closest(".edit-item-btn"),a=e.target.closest(".remove-item-btn"),o=e.target.closest("tr");if(o){var d=o.getAttribute("data-id");if(t){var e=h.find(function(e){return String(e.id)===String(d)});if(!e)return;i&&(i.value=e.id),c&&(c.value=""),s&&(s.value=e.codigo||""),u&&(u.value=e.entregador||""),g&&(g.value=e.servico||""),m&&(m.value=e.status||"Saiu"),v&&(v.value=e.duplicado?"Sim":"Não"),f&&(f.value=e.estacao||"");t=r.querySelector(".modal-title");t&&(t.textContent="Editar Registro")}a&&(e=document.getElementById("delete-record"))&&(e.onclick=function(){window.TrackAPI.deleteSaida(d).then(function(e){e&&e.ok&&(o.remove(),e=bootstrap.Modal.getInstance(document.getElementById("deleteRecordModal")))&&e.hide()})})}}),l&&l.addEventListener("submit",function(e){e.preventDefault();var e=i&&i.value||null,t=(s&&s.value||"").replace(/\D+/g,"");/^\d{44}$/.test(t)?(alert("Código inválido (NF-e). Leia a etiqueta do marketplace."),s&&s.focus()):(t={entregador:(u&&u.value||"").trim(),codigo:(s&&s.value||"").trim(),servico:(g&&g.value||"").trim(),status:m&&m.value||"Saiu",estacao:(f&&f.value||"").trim()},e?window.TrackAPI.updateSaida(e,t).then(function(e){e&&e.ok?(n&&n.hide(),y()):alert(e&&e.error||"Falha ao salvar")}):alert("Cadastro de novo registro é feito pela tela de Leituras. Aqui você pode editar/excluir."))}),a&&(a.addEventListener("change",function(){var e=o.querySelectorAll('input[name="chk_child"]');[].forEach.call(e,function(e){e.checked=a.checked})}),d)&&d.addEventListener("click",function(){var a=[],e=o.querySelectorAll("tr");[].forEach.call(e,function(e){var t=e.querySelector('input[name="chk_child"]');t&&t.checked&&a.push(e.getAttribute("data-id"))}),a.length?confirm("Excluir "+a.length+" registro(s)?")&&window.TrackAPI.bulkDelete(a).then(function(e){e&&e.ok?y():alert(e&&e.error||"Falha ao excluir")}):alert("Selecione ao menos 1 registro.")})}else console.warn(e&&e.error||"Falha ao listar")})}"undefined"==typeof List?console.warn("List.js não carregado"):(t="registroList",o=document.querySelector("#registroTable tbody.list"),a=document.getElementById("checkAll"),d=document.querySelector(".btn.btn-soft-danger"),e=document.querySelector(".add-btn"),r=document.getElementById("showModal"),n=r?new bootstrap.Modal(r):null,l=r?r.querySelector("form.tablelist-form"):null,i=document.getElementById("id-field"),c=document.getElementById("datahora-field"),s=document.getElementById("codigo-field"),u=document.getElementById("entregador-field"),g=document.getElementById("servico-field"),m=document.getElementById("status-field"),v=document.getElementById("duplicado-field"),f=document.getElementById("estacao-field"),h=[],e&&e.addEventListener("click",function(){var e;n&&(i&&(i.value=""),c&&(c.value=""),s&&(s.value=""),u&&(u.value=""),g&&(g.value=""),m&&(m.value="Saiu"),v&&(v.value="Não"),f&&(f.value=""),e=r.querySelector(".modal-title"))&&(e.textContent="Novo Registro (use a tela Leituras para registrar)")}),y())}();